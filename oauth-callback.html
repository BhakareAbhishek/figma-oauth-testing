<!DOCTYPE html>
<html>
<head>
  <title>GitHub OAuth Callback</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      background-color: #f6f8fa;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      max-width: 500px;
      width: 100%;
      text-align: center;
    }
    .code-box {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 4px;
      margin: 20px 0;
      word-break: break-all;
    }
    .message {
      color: #24292e;
      margin-bottom: 20px;
    }
    .success {
      color: #2ea44f;
      font-weight: bold;
    }
    .error {
      color: #cb2431;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="content">
      <h2>GitHub Authorization</h2>
      <p class="message">Processing your authorization...</p>
    </div>
  </div>

  <script>
    (function () {
      const content = document.getElementById('content');
      const url = new URL(window.location.href);
      const code = url.searchParams.get('code');
      const state = url.searchParams.get('state');

      console.log('‚úÖ Code:', code);
      console.log('üîê State:', state);

      if (!code || !state) {
        content.innerHTML = `
          <h2>GitHub Authorization</h2>
          <p class="message error">Error: Missing authorization code or state</p>
          <p>Please try the authorization process again.</p>
        `;
        return;
      }

      if (window.opener) {
        content.innerHTML = `
          <h2>GitHub Authorization</h2>
          <p class="message success">Authorization successful!</p>
          <p>Please copy the code below and return to the Figma plugin:</p>
          <div class="code-box">
            <code>${code}</code>
          </div>
          <p>This window will close automatically in 5 seconds...</p>
        `;

        // Send message to opener
        window.opener.postMessage(
          { type: 'github-code', code, state },
          '*' // allow all origins
        );

        // Close window after 5 seconds
        setTimeout(() => {
          window.close();
        }, 5000);
      } else {
        content.innerHTML = `
          <h2>GitHub Authorization</h2>
          <p class="message error">Error: Could not communicate with plugin</p>
          <p>Please copy the code below and return to the Figma plugin:</p>
          <div class="code-box">
            <code>${code}</code>
          </div>
        `;
      }
    })();
  </script>
</body>
</html>